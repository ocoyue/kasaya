[TOC]


# 新Mac电脑调教：
### Tips
#### 1. 大写需要长按
    - 设置->键盘->输入法->“使用大写锁定键....”
    - finder 显示-> 路径
    - 屏保->触发角
#### 2. chrome
- ⌘+Q  取消推出前提示
- 搜索改成bing
- 新标签页取消bing->重新建一个搜索，我的bing    
`https://www.bing.com/search?q=%s&PC=U316&FORM=CHROMN`

#### 3. brew 不要改镜像，以免后悔莫及
brew cleanup 定期清理一下   
homebrew 提供命令安装   
https://juejin.im/post/5c738bacf265da2deb6aaf97

```bash
# 替换现有上游

git -C "$(brew --repo)" remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git

git -C "$(brew --repo homebrew/core)" remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git

git -C "$(brew --repo homebrew/cask)" remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask.git
brew update
```
```shell
# 复原

git -C "$(brew --repo)" remote set-url origin https://github.com/Homebrew/brew.git

git -C "$(brew --repo homebrew/core)" remote set-url origin https://github.com/Homebrew/homebrew-core.git

git -C "$(brew --repo homebrew/cask)" remote set-url origin https://github.com/Homebrew/homebrew-cask.git

brew update
```

对于 homebrew，需要替换的是4个模块的镜像：

1. Homebrew
2. Homebrew Core
3. Homebrew-bottles
4. Homebrew Cask

而最全的是 USTC（中科大镜像），其他家都缺少第4个，所以换了前三个后，执行 brew update 依然慢的要死; 具体替换方式如下：

```shell
# 替换 Homebrew
git -C "$(brew --repo)" remote set-url origin https://mirrors.ustc.edu.cn/brew.git

# 替换 Homebrew Core
git -C "$(brew --repo homebrew/core)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git

# 替换 Homebrew Cask
git -C "$(brew --repo homebrew/cask)" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git

# 替换 Homebrew-bottles
# 对于 bash 用户：
echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.bash_profile
source ~/.bash_profile
# 对于 zsh 用户：
echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.zshrc
source ~/.zshrc
```


#### 4. 编辑器
- MarkDown编辑 -> Typroa 轻量
- 一般编辑器 -> VS Code
  + Activity Bar -> 右侧
- ⌘ +, Startup Editor,welcome 换 newfile

#### 5.  命令模式
1. 安装 iterm2  
  
	- 勾选 Make iTerm2 Default Term 
  
2. 安装 oh-my-zsh 
  
	- 官网提供命令安装

3. ~~安装python -> pip (此处太磨叽，应该使用直接字体安装!!)~~


4. 安装字体 Powerline

    - 官网命令安装 pip install powerline-status
    - (此处太磨叽，应该使用直接字体安装!!)
    - 有效教程   https://sspai.com/post/55176

 ```shell
cd ~/Downloads && git clone https://github.com/powerline/fonts.git	#将 Powerline 字体文件下载到「下载」文件夹中
      
cd fonts && ./install.sh	#安装所有 Powerline 字体
      
cd && rm -rf ~/Downloads/fonts	#删除下载的字体文件
 ```


5. 主题，在.zshrc中ZSH_THEME -> agnoster
6. 配色，⌘+, -> Profiles -> Colors -> Color Presets -> Solarized Dark
7. 去字体中找一款powerline系列的字体
8. 终端用户名屏蔽设置
  到~/.oh-my-zsh/themes中找到相关主题
  复制一个新的副本
  修改文件中带有 user 或 @ 等关键字进行修改
```Shell
PROMPT="
%{$terminfo[bold]$fg[blue]%}#%{$reset_color%} \
%{$terminfo[bold]$fg[yellow]%}%~%{$reset_color%}\
${hg_info}\
${git_info}\
 \
%{$fg[white]%}[%*] $exit_code
%{$terminfo[bold]$fg[red]%}$ %{$reset_color%}"
# zoe : this is useless info after 50 line ，example : cc @ yandeMBP
# %(#,%{$bg[yellow]%}%{$fg[black]%}%n%{$reset_color%},%{$fg[cyan]%}%n) \
# %{$fg[white]%}@ \
# %{$fg[green]%}%m \
# %{$fg[white]%}in \
以上修改字ys主题
```

9. 另一个方案
    - https://guobinhit.blog.csdn.net/article/details/78482618

10. 另一个方案2，用在Ubu上
    - steeef.zsh-theme


    /usr/local/java/jdk1.8.0_221


#### vim 缩进4个空格
```
vi /etc/vim/vimrc   
set tabstop=4       " Tab键替换的空格长度，默认8    
set softtabstop=4   " 退格键退回缩进空格的长度  
set shiftwidth=4    " 表示每一级缩进的长度  
set expandtab       " 设置缩进用空格来表示  
```


# Linux

## 命令
### 日常命令
常用 mkdir,ls,pwd,cd,      
mkdir -p 递归创建
touch 生成一个空文件    
echo  生成一个有数据的文件，">"覆盖写入，">>"追加写入   
cat 查看; more 翻页查看; head 查看头部; tail 尾部查看;  
cp 拷贝; `cp 1.txt 2.txt`
rm 删除; -r 递归轮巡; -f 不用提醒;  
find 查找文件; `find . -name test.txt`      
grep 查找字段; `cat 1.txt | grep hello`     
ln 软连接; `ln 1.txt 2.txt`     
whereis 定位; `whereis mysql`   
whomai 哈哈，我自己瞎试出来的命令;
### 压缩命令 tar
tar[-cxzjvf]   
tar -c/x -zvf
```
-c 归档(压缩) compress   
-x 解开归档(解压)      
-z/-j 使用gzip/bzip2算法,通常使用-z     
-v 显示过程(View)   
-f 指定归档(压缩)名字   
-tf 查看压缩包(归档文件)内容
```
### 系统管理命令
stat    
who     
hostname    
uname   
top     
ps  
du  
df -h   
free -h     
ifconfig    
ping 心跳检测   
netstat     
clear   

### 账户和组管理
1. 命令
    - useradd 用户名
    - useradd -u (UID号)
    - useradd -p (口令)
    - useradd -g (分组)
    - useradd -s (SHELL)
    - useradd -d (用户目录)

2. 设置root用户密码
`sudo passwd root`

### 文件权限管理 
d      文件类型      d为文件夹-为文件
rwx    用户权限      r读 w写 x执行
r-x    用户所在组的权限    r读 -不可写 x可执行
r-x    其他用户权限

1. 脚本例子
```shell
#!/bin/bash
echo hello ubuntu 
```
无执行权限      
chmod +x test.sh    
2. chmod
change modify   
chmod [who] [+ | - | =] [mode]test.txt
3. chown
change owner
chown [-R] 用户名称 文件或者目录
chown [-R] 用户名称:用户组名称 文件或者目录
4. 数字设定法
0 无 权限    
1 执行 权限  
2 写 权限   
4 读 权限

### 包管理
- 数据源(镜像)
`vi /etc/apt/source.list`

### 部署
#### 安装Java
1. 本地当前目录下haha.heihei文件cp到服务器
`scp haha.heihei root@10.211.55.15:/home/yan007/test007`
2. 解压并放到指定目录
```shell
#解压缩
tar -xzvf jdk**.tar.gz
mkdir -p /usr/local/java
mv jdk /usr/local/java
chown -R root:root /usr/local/java
```
3. 配置环境变量
- 李卫民2.0版P16讲 有待观察 
`vi /etc/environment`
- 我自己的方案  
```
vi .yan007
export JAVA_HOME=这里为java安装目录  
export JRE_HOME=$JAVA_HOME/jre  
export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib  
export PATH=$JAVA_HOME/bin:$PATH 
# 原文链接：https://blog.csdn.net/gao36951/article/details/73321345
vi .bash_profile
source .yan007
# 最后
source .bash_profile
```
#### 安装mysql
```
sudo apt-get install mysql-server
sudo netstat -tap|grep mysql
sudo vim /etc/mysql/debian.cnf
```
略 `systemctl status mysql`     
user     = debian-sys-maint      
password = 7zSfSBnRaSgO2IBb
```
mysql -u root   
update mysql.user set authentication_string=PASSWORD('123456') where User='root';        
flush privileges;   
```
- 配置
`vi /etc/mysql/mysql.conf.d/mysqld.cnf`     
注释    
`bind-address = 127.0.0.1`
重启    
`service mysql restart` 

## Vim
:q 退出
:q! 强制退出
:wq 写入退出
:set number 显示行号
:set nonumber 不显示行号
/  查找字符串
:w file 当前内容保存为某文件

## 目录管理
例子： MySql
my.cnf  -> /etc     
data    -> /var     
command -> /bin

## 新服务器 调教
只用自己网盘里13.tnt.dmg版本靠谱

#### SSH免密登录服务器
```shell
# scp /root/.ssh/id_rsa.pub root@192.168.1.181:/root/.ssh/authorized_keys
# 笨办法
cd
mkdir .ssh
cd .ssh
touch authorized_keys
# chmod 600 /yan/.ssh/authorized_keys
```
将本地 id_sra.pub 内容粘贴到authorized_keys中   
本地 ssh yan@10.211.55.9

#### 开启允许远程连接
```shell
sudo passwd root
# 设置两次密码
# 切换root
su
vi /etc/ssh/sshd_config
# 命令模式显示行号
set number
# 命令模式找到关键字PermitRootLogin
/PermitRootLogin
# 编辑模式进行编辑
PermitRootLogin yes
# 重启ssh服务
service ssh restart
```
当然，对我来说，只要去root目录下，把SSH免密登录再执行一次就可以了   
或者，cp 这个 authorized_keys到/root/.ssh/

#### oh my zsh(ubuntu)
- 原文
https://dev.to/mskian/install-z-shell-oh-my-zsh-on-ubuntu-1804-lts-4cm4
- 摘抄
    1. 更新
    ```shell
    sudo apt-get update     
    sudo apt upgrade        
    ```
    2. 安装
    ```
    sudo apt install zsh        
    sudo apt-get install powerline fonts-powerline  
    git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
    ```
    3. 配置
    ```
    cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc     
    ZSH_THEME="agnoster" 
    ```
    4. 切换shell
    ```
    chsh -s /bin/zsh 
    ```
    5. 卸载或更新
        - Update & Uninstallation oh-my-zsh Visit    https://github.com/robbyrussell/oh-my-zsh#manual-updates
        ```
        cd .oh-my-zsh
        upgrade_oh_my_zsh
        ```
    6. - 有效教程   
    https://sspai.com/post/55176
    
    7. 高亮 Want Syntax Highlighting? install ZSH Syntax Highlighting for Oh My Zsh
        - Clone the ZSH Syntax Highlighting
        ```
        git clone https://github.com/zsh-users/zsh-syntax-highlighting.git "$HOME/.zsh-syntax-highlighting" --depth 1
        ```
        - Add syntax-highlighting in .zshrc Configuration
        ```
        echo "source $HOME/.zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" >> "$HOME/.zshrc"
        ```
    7. Revert Back to Default Shell
    ```
    chsh -s /bin/bash
    ```

## Linux LVM 磁盘扩容
TODO    


## 经验
查看当前java有多少个已经安装的版本
/usr/libexec/java_home -V

###### MAC 配置java，vim 
https://www.cnblogs.com/zjx2711904647/p/7735556.html

###### 配置zookeeper
https://blog.csdn.net/whereismatrix/article/details/50420099

###### kafka安装和使用
https://blog.csdn.net/yu_meiguang/article/details/77685166

###### zk + kafka
zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties & kafka-server-start /usr/local/etc/kafka/server.properties






# Docker
## Docker基础
- https://www.runoob.com/docker/docker-run-command.html

### Docker 生命周期管理
#### run   
`docker run [OPTIONS] IMAGE [COMMAND] [ARG...]`     
-d 后台运行，并返回容器ID；    
-i 交互式运行   
-P 随机端口映射     
-p 指定端口映射，格式为 `宿主机端口:容器端口`   
--name="hahaha": 为容器指定名称；   
--dns 8.8.8.8 指定容器使用DNS服务器
```
docker run --name haha -d nginx:latest
```
#### start/stop/restart
#### kill   
杀掉一个运行中的容器。 
-s :向容器发送一个信号  
`docker kill -s KILL mynginx`
#### rm 
删除容器
```
# 强制删除容器db01、db02
docker rm -f db01 db02
# 移除容器nginx01对容器db01的连接，连接名db
docker rm -l db 
#删除容器nginx01,并删除容器挂载的数据卷
docker rm -v nginx01
```
#### pause/unpause
```
# 暂停数据库容器db01提供服务。
docker pause db01
# 恢复数据库容器db01提供服务。
docker unpause db01
```
#### exec      
```
# 在容器 mynginx 中以交互模式执行容器内 /root/runoob.sh 脚本:
runoob@runoob:~$ docker exec -it 容器名 /bin/sh /root/runoob.sh
http://www.runoob.com/
#在容器 mynginx 中开启一个交互模式的终端:
runoob@runoob:~$ docker exec -i -t  mynginx /bin/bash
root@b1a0703e41e7:/#
```

### Docker 容器操作

#### ps

`docker ps [OPTIONS]`   

-a :显示所有的容器，包括未运行的。
-f :根据条件过滤显示的内容。
--format :指定返回值的模板文件。
-l :显示最近创建的容器。
-n :列出最近创建的n个容器。
--no-trunc :不截断输出。
-q :静默模式，只显示容器编号。
-s :显示总的文件大小。

```
# 列出所有在运行的容器信息。
runoob@runoob:~$ docker ps
# 列出最近创建的5个容器信息。
runoob@runoob:~$ docker ps -n 5
# 列出所有创建的容器ID。
runoob@runoob:~$ docker ps -a -q
```
#### logs
查看容器mynginx从2016年7月1日后的最新10条日志。     
`docker logs --since="2016-07-01" --tail=10 mynginx`

#### 其他
- top
- attach
- events
- wait
- export
- port

### 镜像仓库
#### pull
#### search
从Docker Hub查找所有镜像名包含java，并且收藏数大于10的镜像    
`docker search -s 10 java`
#### 其他
- push
- login/logout

### 镜像管理
#### images
-a :列出本地所有的镜像（含中间映像层，默认情况下，过滤掉中间映像层）；    
--digests :显示镜像的摘要信息； 
-f :显示满足条件的镜像；    
--format :指定返回值的模板文件；    
--no-trunc :显示完整的镜像信息；    
-q :只显示镜像ID。  
`docker images -q  ubuntu`

#### rmi 
- -f 强制   
`docker rmi -f runoob/ubuntu:v4`

#### 其他
- build     
    此打包要注意`.`是上下文，不是当前目录
- history
- save
- load
- import

### docker info/versoin
### rootfs


## Dockerfile
- 参见https://github.com/docker-library
- 实例 https://github.com/docker-library/tomcat/blob/master/7/jdk8/openjdk/Dockerfile

## DockerCompose
- 子网掩码026




## 经验
- 一条命令实现停用并删除容器：    
`docker stop $(docker ps -q) & docker rm $(docker ps -aq)`
- 其他
```
s
docker images 查询镜像；    
docker system df 体积      
虚悬镜像；      
中间层镜像；    
docker rmi aaa;
docker ps查询 正在运行的容器    
守护态运行
docker run -p 8080:8080 -d tomcat   
-d 守护态运行   
-p 宿主机端口:容器端口      
docker stop     
docker run -p 8080:8080 --name tomcat7 -d tomcat    
docker exec -it id/name /bin/bash
docker container prune 停止所有
htts://k7da99jp.mirror.aliyuncs.com
```
 
 
 
 # 环境调教
## GitLab 搭建
### 基于DockerCompose
#### 中文版GitLab：
原址：   
https://github.com/twang2218/gitlab-ce-zh      
   
vi docker-compose.yml   
```
version: '3'
services:
    web:
        image: 'twang2218/gitlab-ce-zh'
        restart: always
        # 可以是域名
        hostname: '192.168.199.194'
        environment:
            TZ: 'Asia/Shanghai'
            GITLAB_OMNIBUS_CONFIG:
                external_url 'http://192.168.199.194'
                gitlab_rails['gitlab_shell_ssh_port'] = 2222
                unicorn['port'] = 8888
                nginx['listen_port'] = 80
        ports:
            - '80:80'
            - '443:443'
            - '2222:22'
        volumes:
            - ./config:/etc/gitlab
            - ./data:/var/opt/gitlab
            - ./logs:/var/log/gitlab
```
 
- 按照docker-compose中文版文档操作，会报错      
    External URL must include a FQDN
- 将external_url 'xxx' 改成 external_url = 'xxx'
 